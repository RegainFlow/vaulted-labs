import {
  OPEN_TUTORIAL_BONUS_SHOWN_EVENT,
  OPEN_TUTORIAL_RESULT_CHOSEN_EVENT,
  OPEN_TUTORIAL_REVEAL_READY_EVENT,
  OPEN_TUTORIAL_VAULT_SELECTED_EVENT,
} from "../lib/tutorial-events";
import type {
  TutorialDefinition,
  TutorialStepDefinition,
} from "../types/tutorial";

export const VAULT_TUTORIAL_STORAGE_KEY = "vaults_intro_completed";
export const LOCKER_TUTORIAL_STORAGE_KEY = "locker_intro_completed";
export const WALLET_TUTORIAL_STORAGE_KEY = "wallet_intro_completed";

export const VAULT_TUTORIAL_STEPS: TutorialStepDefinition[] = [
  {
    id: "vault-intro",
    kind: "intro",
    kicker: "Vault Scan Tutorial",
    title: "Open Vaults",
    body: "Pick a vault, review the drop details, charge the scan, and choose what to do with the collectible you pull.",
    actionLabel: "Begin",
  },
  {
    id: "vault-card",
    kind: "rail",
    kicker: "Vault Scan Tutorial",
    title: "The Vault",
    body: "Each vault tier has its own price and value range. Higher tiers cost more and can return stronger pulls.",
    target: {
      selector: '[data-tutorial="vault-entry"]',
      fallbackSelectors: ['[data-tutorial="vault-grid"]'],
      padding: 10,
      radius: 20,
      showRing: true,
    },
  },
  {
    id: "vault-transparency",
    kind: "rail",
    kicker: "Vault Scan Tutorial",
    title: "Check Contents and Odds",
    body: "Use Contents and Odds before opening so the drop pool and rarity distribution stay transparent.",
    target: {
      selectors: [
        '[data-tutorial="vault-contents"]',
        '[data-tutorial="vault-odds"]',
      ],
      padding: 10,
      radius: 16,
      requireAll: true,
      showRing: true,
    },
  },
  {
    id: "vault-open",
    kind: "rail",
    kicker: "Vault Scan Tutorial",
    title: "Open Vault",
    body: "Tap this vault card to open it.",
    actionLabel: "Tap Vault",
    target: {
      selector: '[data-tutorial="vault-entry"]',
      padding: 12,
      radius: 20,
      showRing: true,
    },
    advanceOn: [
      {
        type: "event",
        eventName: OPEN_TUTORIAL_VAULT_SELECTED_EVENT,
      },
    ],
  },
  {
    id: "vault-scan",
    kind: "rail",
    kicker: "Vault Scan Tutorial",
    title: "Charge the Scan",
    body: "Hold SCAN, then release.",
    hint: "Hold SCAN, then release",
    actionLabel: "Hold SCAN",
    accentColor: "accent",
    compact: true,
    placement: "top",
    target: {
      selector: '[data-tutorial="scan-button"]',
      padding: 10,
      radius: 18,
      showRing: true,
    },
    advanceOn: [
      {
        type: "event",
        eventName: OPEN_TUTORIAL_BONUS_SHOWN_EVENT,
        nextStepId: "vault-bonus",
      },
      {
        type: "event",
        eventName: OPEN_TUTORIAL_REVEAL_READY_EVENT,
        nextStepId: "vault-reveal",
      },
    ],
  },
  {
    id: "vault-bonus",
    kind: "rail",
    kicker: "Vault Scan Tutorial",
    title: "Bonus Scan",
    body: "Tap LOCK.",
    hint: "Tap LOCK",
    actionLabel: "Tap LOCK",
    accentColor: "neon-green",
    compact: true,
    placement: "top",
    target: {
      selector: '[data-tutorial="bonus-lock"]',
      padding: 10,
      radius: 16,
      showRing: true,
    },
    advanceOn: [
      {
        type: "event",
        eventName: OPEN_TUTORIAL_REVEAL_READY_EVENT,
      },
    ],
  },
  {
    id: "vault-reveal",
    kind: "rail",
    kicker: "Vault Scan Tutorial",
    title: "Choose an Outcome",
    body: "Pick Cashout, Equip, or Ship.",
    actionLabel: "Choose One",
    compact: true,
    placement: "top",
    target: {
      selectors: [
        '[data-tutorial="reveal-cashout"]',
        '[data-tutorial="reveal-equip"]',
        '[data-tutorial="reveal-ship"]',
      ],
      fallbackSelectors: ['[data-tutorial="reveal-actions"]'],
      padding: 10,
      radius: 18,
      requireAll: false,
      showRing: true,
    },
    advanceOn: [
      {
        type: "event",
        eventName: OPEN_TUTORIAL_RESULT_CHOSEN_EVENT,
        nextStepId: "vault-complete",
      },
    ],
  },
  {
    id: "vault-complete",
    kind: "complete",
    kicker: "Vault Scan Tutorial",
    title: "Tutorial Complete",
    body: "You have seen the full vault flow. Tutorial actions do not change your credits or items.",
    actionLabel: "Done",
  },
];

export const LOCKER_TUTORIAL_STEPS: TutorialStepDefinition[] = [
  {
    id: "locker-intro",
    kind: "intro",
    kicker: "Locker Tutorial",
    title: "Your Locker",
    body: "Locker is your control hub for saved collectibles, market activity, and arena systems.",
    actionLabel: "Begin",
  },
  {
    id: "locker-tabs",
    kind: "spotlight",
    kicker: "Locker Tutorial",
    title: "Section Rail",
    body: "Use this command rail to move between Inventory, Market, and Arena.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="locker-tabs"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "locker-inventory",
    kind: "rail",
    kicker: "Locker Tutorial",
    title: "Inventory",
    body: "Saved collectibles live here. From Inventory you can ship, cash out, or list held items.",
    hint: "Inventory is where saved collectibles live",
    target: {
      selector: '[data-tutorial="locker-inventory"]',
      padding: 12,
      radius: 20,
      showRing: true,
    },
    command: { type: "locker:set-section", section: "inventory" },
  },
  {
    id: "locker-market",
    kind: "rail",
    kicker: "Locker Tutorial",
    title: "Market",
    body: "Market combines buy-now listings and auctions so you can browse demand from one place.",
    hint: "Browse market listings and auctions here",
    target: {
      selector: '[data-tutorial="locker-market"]',
      padding: 12,
      radius: 20,
      showRing: true,
    },
    command: { type: "locker:set-section", section: "market" },
  },
  {
    id: "locker-arena",
    kind: "rail",
    kicker: "Locker Tutorial",
    title: "Arena",
    body: "Arena is where your collectibles drive battles, forge upgrades, and progression systems.",
    hint: "Launch battles, forge, and quests from here",
    target: {
      selector: '[data-tutorial="locker-arena"]',
      padding: 12,
      radius: 20,
      showRing: true,
    },
    command: { type: "locker:set-section", section: "arena" },
  },
  {
    id: "locker-complete",
    kind: "complete",
    kicker: "Locker Tutorial",
    title: "Locker Ready",
    body: "You now know where to manage items, watch the market, and launch arena systems.",
    actionLabel: "Done",
  },
];

export const WALLET_TUTORIAL_STEPS: TutorialStepDefinition[] = [
  {
    id: "wallet-intro",
    kind: "intro",
    kicker: "Wallet Tutorial",
    title: "Wallet",
    body: "Wallet tracks your balance, credit sources, and every transaction that changes your spending power.",
    actionLabel: "Begin",
  },
  {
    id: "wallet-balance",
    kind: "spotlight",
    kicker: "Wallet Tutorial",
    title: "Balance Header",
    body: "This is your current spendable credit balance.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="wallet-balance"]',
      padding: 10,
      radius: 20,
    },
  },
  {
    id: "wallet-breakdown",
    kind: "spotlight",
    kicker: "Wallet Tutorial",
    title: "Credit Breakdown",
    body: "Earned, Incentive, and Spent stay separated so the source of value is always clear.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="wallet-breakdown"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "wallet-filters",
    kind: "spotlight",
    kicker: "Wallet Tutorial",
    title: "Transaction Filters",
    body: "Filter the ledger by transaction type when you need to isolate one credit stream.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="wallet-filters"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "wallet-transactions",
    kind: "spotlight",
    kicker: "Wallet Tutorial",
    title: "Transaction History",
    body: "Every vault purchase, reward, incentive grant, and cashout appears here.",
    placement: "top",
    target: {
      selector: '[data-tutorial="wallet-transactions"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "wallet-actions",
    kind: "spotlight",
    kicker: "Wallet Tutorial",
    title: "Quick Actions",
    body: "Use these actions to route back into funding or cashout flows when you need them.",
    placement: "top",
    target: {
      selector: '[data-tutorial="wallet-actions"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "wallet-complete",
    kind: "complete",
    kicker: "Wallet Tutorial",
    title: "Wallet Ready",
    body: "You can replay this tutorial anytime from the help tools.",
    actionLabel: "Done",
  },
];

export const COLLECTION_TUTORIAL_STEPS: TutorialStepDefinition[] = [
  {
    id: "collection-intro",
    kind: "intro",
    kicker: "Collection Tutorial",
    title: "Collection",
    body: "Manage held items, browse listings, and watch auctions from one control surface.",
    actionLabel: "Begin",
  },
  {
    id: "collection-tabs",
    kind: "spotlight",
    kicker: "Collection Tutorial",
    title: "Section Rail",
    body: "Switch between your collection, the market, and auctions here.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="collection-tabs"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "collection-item",
    kind: "spotlight",
    kicker: "Collection Tutorial",
    title: "Collectible Card",
    body: "Each collectible card tracks rarity, value, and available actions.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="collection-item"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "collection-actions",
    kind: "spotlight",
    kicker: "Collection Tutorial",
    title: "Item Actions",
    body: "Use the action rail to ship, cash out, or list held items.",
    placement: "top",
    target: {
      selector: '[data-tutorial="collection-actions"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "collection-market-tab",
    kind: "spotlight",
    kicker: "Collection Tutorial",
    title: "Market Tab",
    body: "Move into Market for fixed-price listings.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="collection-market-tab"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "collection:set-tab", tab: "market" },
  },
  {
    id: "collection-listing",
    kind: "spotlight",
    kicker: "Collection Tutorial",
    title: "Listing Card",
    body: "Compare rarity and pricing before you buy.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="shop-listing"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "collection:set-tab", tab: "market" },
  },
  {
    id: "collection-auction-tab",
    kind: "spotlight",
    kicker: "Collection Tutorial",
    title: "Auctions Tab",
    body: "Switch to auctions when you want to bid instead of buying instantly.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="collection-auction-tab"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "collection:set-tab", tab: "auctions" },
  },
  {
    id: "collection-auction",
    kind: "spotlight",
    kicker: "Collection Tutorial",
    title: "Auction Card",
    body: "Watch the timer and outbid the current leader before the auction closes.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="shop-auction"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "collection:set-tab", tab: "auctions" },
  },
  {
    id: "collection-complete",
    kind: "complete",
    kicker: "Collection Tutorial",
    title: "Collection Ready",
    body: "You can manage, trade, and route collectibles from here.",
    actionLabel: "Done",
  },
];

export const ARENA_TUTORIAL_STEPS: TutorialStepDefinition[] = [
  {
    id: "arena-intro",
    kind: "intro",
    kicker: "Arena Tutorial",
    title: "Arena",
    body: "Arena is where battles, forge upgrades, and quests convert your collectibles into progression.",
    actionLabel: "Begin",
  },
  {
    id: "arena-resources",
    kind: "spotlight",
    kicker: "Arena Tutorial",
    title: "Resources",
    body: "Energy, shards, and progression stats all feed the arena loop.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="arena-resources"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "arena-tabs",
    kind: "spotlight",
    kicker: "Arena Tutorial",
    title: "Section Rail",
    body: "Use this rail to move between Battles, Forge, and Quests.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="arena-tabs"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "arena-battles",
    kind: "spotlight",
    kicker: "Arena Tutorial",
    title: "Battles",
    body: "Spend energy here to fight bosses and earn shard rewards.",
    placement: "top",
    target: {
      selector: '[data-tutorial="arena-battles"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "arena:set-section", section: "battles" },
  },
  {
    id: "arena-tab-forge",
    kind: "spotlight",
    kicker: "Arena Tutorial",
    title: "Forge Tab",
    body: "Switch here to combine collectibles into stronger outcomes.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="arena-tab-forge"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "arena:set-section", section: "forge" },
  },
  {
    id: "arena-forge",
    kind: "spotlight",
    kicker: "Arena Tutorial",
    title: "Forge",
    body: "Forge combines three collectibles into one new result.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="arena-forge"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "arena:set-section", section: "forge" },
  },
  {
    id: "arena-tab-quests",
    kind: "spotlight",
    kicker: "Arena Tutorial",
    title: "Quests Tab",
    body: "Move into Quests to track milestones and XP gains.",
    placement: "bottom",
    target: {
      selector: '[data-tutorial="arena-tab-quests"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "arena:set-section", section: "quests" },
  },
  {
    id: "arena-quests",
    kind: "spotlight",
    kicker: "Arena Tutorial",
    title: "Quests",
    body: "Quest progress gives you steady XP outside the battle loop.",
    placement: "top",
    target: {
      selector: '[data-tutorial="arena-quests"]',
      padding: 10,
      radius: 18,
    },
    command: { type: "arena:set-section", section: "quests" },
  },
  {
    id: "arena-rankup",
    kind: "spotlight",
    kicker: "Arena Tutorial",
    title: "Rank Up",
    body: "Leveling raises your access and eventually unlocks prestige.",
    placement: "top",
    target: {
      selector: '[data-tutorial="arena-rankup"]',
      padding: 10,
      radius: 18,
    },
  },
  {
    id: "arena-complete",
    kind: "complete",
    kicker: "Arena Tutorial",
    title: "Arena Ready",
    body: "You can battle, forge, and track quests from here.",
    actionLabel: "Done",
  },
];

export const TUTORIALS: Record<string, TutorialDefinition> = {
  vaults: {
    id: "vaults",
    storageKey: VAULT_TUTORIAL_STORAGE_KEY,
    steps: VAULT_TUTORIAL_STEPS,
  },
  locker: {
    id: "locker",
    storageKey: LOCKER_TUTORIAL_STORAGE_KEY,
    steps: LOCKER_TUTORIAL_STEPS,
  },
  wallet: {
    id: "wallet",
    storageKey: WALLET_TUTORIAL_STORAGE_KEY,
    steps: WALLET_TUTORIAL_STEPS,
  },
  collection: {
    id: "collection",
    steps: COLLECTION_TUTORIAL_STEPS,
  },
  arena: {
    id: "arena",
    steps: ARENA_TUTORIAL_STEPS,
  },
};
